# Device Mapper Proxy (dmp)
Модуль ядра Linux, который создает виртуальные блочные устройства и следит за статистикой выполняемых на устройстве операций.
Поддерживаемые статистические данные:
- Количество запросов на чтение
- Количество запросов на запись
- Общее количество запросов
- Средний размер блока на чтение
- Средний размер блока на запись
- Средний размер блока

## Сборка
Для сборки модуля используйте команду `make`.  
Для очистки директории от всех файлов, полученных в результате компиляции, используйте команду `make` с параметром `clean`:
```
make clean
```

## Установка
Для установки модуля используйте команду `insmod`:
```
insmod /path/to/module/dmp.ko
```

## Тестирование
Проверить корректную установку можно с помощью команды `lsmod`. Для вывода сообщений ядра используйте команду `dmesg`.  
Вывод статистических данных осуществляется следующим образом:
```
cat /sys/module/dmp/stat/volumes
```
Пример вывода:  
![Screenshot 2024-05-21 221132](https://github.com/an-yudin/Device-Mapper-Proxy/assets/170461920/ae5c2bed-3d72-4bff-97c2-bf0919318e89)

### Создание устройств
Создание тестового блочного устройства:
```
dmsetup create $zero_name --table "0 $size zero"
```
где $zero_name — название устройства, $size - его размер.  
  
Создание proxy-устройства:
```
dmsetup create $dmp_name --table "0 $size dmp /dev/mapper/$zero_name"
```
где $dmp_name — название proxy-устройства.  

Проверить успешность создания устройств можно следующим образом:
```
ls -al /dev/mapper/*
```
Пример вывода:  
![Screenshot 2024-05-21 220736](https://github.com/an-yudin/Device-Mapper-Proxy/assets/170461920/e80a579d-0ce1-417b-bd99-ac005b57b8ab)

### Операции на запись и чтение
Для выполнения операций используйте команду `dd`. Пример использования:
```
dd if=/dev/random of=/dev/mapper/dmp1 bs=4k count=1
dd of=/dev/null if=/dev/mapper/dmp1 bs=4k count=1
```

## Комментарий
Собиралось gcc 12.3.0.  
Тестировалось в Ubuntu 22.04.4 LTS (kernel version: 6.5.0-35-generic).
